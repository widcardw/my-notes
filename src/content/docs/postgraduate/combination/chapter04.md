---
title: 第四章 生成排列组合
---

## 4.1 生成排列

由钱 $n$ 个正整数组成的集合 ${1,2,...,n} 有 $n!$ 个排列

```am
n! ~ sqrt(2pi n) (n/e)^n
```

目标：简单优美地生成 ${1,2,...,n}$ 所有排列的算法。

### 算法 1

给定 ${1,2,...,n-1}$ 的 $(n-1)!$ 个排列的表，能够通过以所有可能的方式，系统地将 $n$ 插入到 ${1,2,...,n-1}$ 的每个排列中，得到 $n!$ 个排列的表。

### 算法 2

定义如果一个整数 $k$ 的箭头指向一个与其相邻但比它小的整数，那么称这个 $k$ 是可移动的。

> 1 从来不可移动
> 
> 除了下面两种情形外，$n$ 总是可以移动的
> - $n$ 是第一个整数而它的箭头指向左边
> - $n$ 是最后一个整数而它的箭头指向右边

- 从 $1^<-,2^<-,...,n^<-$ 开始
- 当存在可移动整数时
	- 求出最大可移动整数 $m$
	- 交换 $m$ 和它的箭头

```
 1  1l 2l 3l 4l   4
 2  1l 2l 4l 3l   4
 3  1l 4l 2l 3l   4
 4  4l 1l 2l 3l   3
 5  4r 1l 3l 2l   4
 6  1l 4r 3l 2l   4
 7  1l 3l 4r 2l   4
 8  1l 3l 2l 4r   3
 9  3l 1l 2l 4l   4
10  3l 1l 4l 2l   4
11  3l 4l 1l 2l   4
12  4l 3l 1l 2l   2
13  4r 3r 2l 1l   4
14  3r 4r 2l 1l   4
15  3r 2l 4r 1l   4
16  3r 2l 1l 4r   3
17  2l 3r 1l 4l   4
18  2l 3r 4l 1l   4
19  2l 4l 3r 1l   4
20  4l 2l 3r 1l   3
21  4r 2l 1l 3r   4
22  2l 4r 1l 3r   4
23  2l 1l 4r 3r   4
24  2l 1l 3r 4r   end
```

生成 ${1,2,...,n}$ 的随机排列：使用某种方法生成一个排列，使得这 $n!$ 个开裂中每个排列被生成的概率都为 $1/n!$

Knuth shuffle 方法：从一个更等排列 $1,2, ..., n$ 开始，对于 $1,2,...,n-1$ 中的每一个整数，连续随机地从 $k, k+1,...,n$ 个位置中为它们选定一个位置，并把位置 $k$ 上的整数与被训吖啶的位置交换。

## 4.2 排列中的逆序

设 $i_1,i_2,...,i_n$ 是集合 1~n 的一个排列，如果 $k<l$ 且 $i_k>i_l$， 则称数对 $(i_k,i_l)$ 为一个逆序。

> 排列 31524 有 4 个逆序对，分别为 (3, 1), (3, 2), (5, 2), (5, 4)

### 逆序列

对于一个排列 $i_1,i_2,...,i_n$，其逆序列 $a_1a_2...a_n$，其中 $a_j$ 标识第二个成分是 $j$ 的逆序的数量。

换句话说，$a_j$ 代表在 $i_j$ 这个数左边，有多少个比 $i_j$ 大的数。

> 31524 的逆序列为 1, 2, 0, 1, 0
> - 1 的左边有 1 个比 1 大的数字——3
> - 2 左边有 2 个比 2 大的数字——3, 5
> - 3 左边没有比 3 大的数字
> - 4 左边有 1 个比 4 大的数字——5
> - 5 左边没有比 5 大的数字

从逆序列可以唯一构建一个排列

### 定理 4.2.1

设 $b_1,...,b_n$ 是满足下面条件的整数序列

```am
0 <= b_1 <= n-1, 0 <= b_2 <= n-2, ..., 0 <= b_(n-1) <= 1, b_n=0
```

那么一定存在唯一一个 ${1,2,...,n}$ 的排列，其逆序列为 $b_1,...,b_n$

### 逆序列构建原排列

假设逆序列为 5, 3, 4, 0, 2, 1, 1, 0

```
_ _ _ _ _ 1 _ _
_ _ _ 2 _ 1 _ _
_ _ _ 2 _ 1 3 _
4 _ _ 2 _ 1 3 _
4 _ _ 2 5 1 3 _
4 _ 6 2 5 1 3 _
4 _ 6 2 5 1 3 7
4 8 6 2 5 1 3 7
```

## 4.3 生成组合

$n$ 元集合 $S_n$ 中选组合，把它的 $2^n$ 个子集看成 $2^n$ 个 0 和 1 的组合。

生成所有的 $2^n$ 个子集：将 $2^n$ 用二进制按顺序写，取位数为 1 的那个元素。该顺序被称为“字典序”。

### 生成时使相邻子集差异尽可能小

Gray 码

```
000
001
011
010
110
111
101
100
```

Gray 码生成方式：比如现在生成了 $2^k$ 个 Gray 码，那么将上面的 Gray 码逆序抄下来，然后将抄下来的 $2^k$ 个 Gray 码的第 $k$ 位（从右 0 开始数）更改为 1

Gray 码后继

1. 如果 1 的数量为偶数，则更改翻转最右一位
2. 如果 1 的数量为奇数，则从右找第一个 1，翻转它左边的一位

## 4.4 生成 r 子集

从 $S = {1, 2, ..., n}$ 中选出一个 $r$ 子集，生成所有的 $r$ 子集

```am
a_1a_2...a_r
```

```am
1<=a_1<a_2<...<a_r<=n
```

最后一个 $r$ 子集为 ${n-r+1,n-r+2, ..., n}$

找后继：找到一个 $a_k<n$ 使得 $a_k+1$ 不等于 $a_(k+1), ...,a_n$ 中的任意一个，将 $a_k$ 加一，后续依次加一，构成序列

找绝对位置：子集 ${a_1,a_2,...,a_r}$ 出现的位置为

```am
n choose r - (n-a_1) choose r - (n-a_2) choose(r-1) - ... - (n-a_(r-1)) choose 2 - (n-a_r) choose 1
```

## 4.5 偏序和等价关系

### 离散数学

给定 $R$ 是 $A$ 上的二元关系

1. 自反性
	- $AA x in A, (:x, x:) in R$
	- $I_A sube R$
	- 主对角线上都是 1 的矩阵
2. 反自反性
	- $AA x in A, (:x, x:) !in R$
	- $I_A nn R=O/$
	- 主对角线上都是 0 的矩阵
3. 对称性
	- $AA x, y in A, (:x,y:)in R -> (:y,x:)in R$
	- $R = R^-1$
	- 对称矩阵
4. 反对称性
	- $AA x,y in A, (:x,y:)in R ^^ (:y,x:)in R -> x=y$
	- $R nn R^-1 sube I_A$
	- 当矩阵中 $i!=j$ 且 $A[i,j]=1$ 则 $A[j,i]$ 必须为 0
5. 传递性
	- $AA x,y,z in A, (:x,y:)inR ^^ (:y,z:)in R ->(:x,z:)in R$
	- $R=R uu R^2 uu R^3 uu ...$

存在一些事件既不是对称的，也不是反对称的

- 等价关系满足 1, 3, 5，例如“同奇偶”
- 偏序关系满足 1, 4, 5，例如“大于等于”，“整除”
	- $x -<= y$

### 定理 4.5.1

设 $X$ 是有 $n$ 个元素的有限集合，则 $X$ 上的全序与 $X$ 的排列之间存在一一对应。特别的，$X$ 上不同全序的个数为 $n!$


