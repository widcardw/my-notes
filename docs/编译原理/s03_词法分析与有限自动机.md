# 第 3 章 词法分析与有限自动机

## 3.1. 词法分析器的设计

### 3.1.1. 词法分析器的任务

输入源程序，输出单词符号

![[public/compile/S03_01.svg]]

单词符号是最小的语义单位。

### 3.1.2. 词法分析器输出形式

词法分析器所输出的单词符号通常表示为二元式（单词种别，单词符号的属性）

#### 单词的种类

| 种类   | 说明                                                       |
| ------ | ---------------------------------------------------------- |
| 关键字 | 又称基本字、保留字，是由程序语言定义的具有固定意义的标识符 |
| 标识符 | 用来标识各种名字，如变量名、数组名、过程名、函数名等       |
| 常数   | 整型、实型、字符型等，如 `0`, `abc`                        |
| 运算符 | 如算术运算符、逻辑运算符、关系运算符                       |
| 界限符 | `,` `;` `(` `)` `[` `]` `{` `}` `=` `/*` `*/` 等           | 

除以上外，还包括编辑符，如空格符、回车符、换行符、制表符等

#### 单词的属性值

书上好像并没有看到有什么比较有价值的东西😅

## 3.2. 词法分析器 的手工打造

### 3.2.1. 确定的有限自动机

**定义 3.1** 一个确定的有限自动机（DFA）$M$ 是一个五元组 $M=(S,\Sigma,\delta,s_0,F)$，式中

- $S$ 是一个有限集，它的每一个元素称为一个状态
- $\Sigma$ 是一个有穷字母表，它的每个元素称为一个输入字符
- $\delta$ 是一个从 $S\times\Sigma$ 到 $S$ 的单值部分映射。$\delta(s,a)=s^\prime$ 表示在目前状态 $s$ 下输入字符为 $a$ 时，将转换到下一个状态 $s^\prime$，$s^\prime$ 被称为 $s$ 的一个后继状态
    ![[public/compile/S03_02.svg]]
- $s_0\in S$ 是==唯一==的初态
- $F\subseteq S$ 是一个终态，可空

**例如** 有 DFA $M=(\{0,1,2,3\},\{a,b\},\delta,0,\{3\})$，其中，$\delta$ 定义为

$$
\begin{aligned}
\delta(0,a)=1 &&\delta(0,b)=2 && \delta(1,a)=3 && \delta(1,b)=2\\
\delta(2,a)=1 &&\delta(2,b)=3 && \delta(3,a)=3 && \delta(3,b)=3
\end{aligned}
$$

可以画出状态转换矩阵，此时可以看出其定义中第三条的含义

![[public/compile/S03_03.svg]]

以及状态转换图

![[public/compile/S03_04.svg]]

### 3.2.2. 构造单词的确定有限自动机

### 3.2.3. 编写一个 C 语言词法分析器

留给实验部分

## 3.3. 有限自动机及其化简

### 3.3.1. 不确定有限自动机

**定义 3.2** 一个不确定有限自动机（NFA）$M$ 是一个五元组 $M=(S,\Sigma,\delta,S_0,F)$，其中

- $S$ 是一个有限集，它的每一个元素称为一个状态
- $\Sigma$ 是一个有穷字母表，它的每个元素称为一个输入字符
- $\delta$ 是一个从 $S\times\Sigma^*$ 到 $S$ 的子集映射，即 $\delta: S\times\Sigma^*\rightarrow 2^S$
- $S_0\subseteq S$ 是一个非空初态==集==
- $F\subseteq S$ 是一个终态集（可空） 

DFA 是 NFA 的特例，而 NFA 是 DFA 概念的推广

### 3.3.2. 不确定有限自动机的化简

对任意给定的 NFA，都能相应构造一个 DFA 使它们接受相同的语言

**定义 3.3** 假定 $I$ 是 NFA $M$ 的状态集子集，定义 $I$ 的 $\varepsilon\text{-Closure}(I)$ 如下

- 若 $q\in I$ ，则 $q\in\varepsilon\text{-Closure}(I)$
- 若 $q\in I$，则从 $q$ 触发经过任意条 $\varepsilon$ 弧而能到达的任何状态 $q^\prime$，有 $q^\prime\in\varepsilon\text{-Closure}(I)$

**性质 3.1** 假定 $I=\{I_1,I_2,\cdots,I_i\}$ 是 NFA $M$ 的状态集的子集，对 $a\in\Sigma$，有 $\delta(I,a)=\delta(I,\varepsilon^* a\varepsilon^*)$ 成立，且 $\delta(I,a)=\bigcup_{j=1}^{i}\delta(I_j,\varepsilon^* a\varepsilon^*)$

**定理 3.1** 对任意一 NFA $M$，都存在一个 DFA $M^\prime$，使得 $L(M^\prime)=L(M)$

**例 3.3** 将 NFA $M$ 确定化

![[public/compile/S03_05.svg]]

| 新生成的状态 \\ 输入                          | a             | b             | c             |
| --------------------------------------------- | ------------- | ------------- | ------------- |
| $\varepsilon\text{-Closure}(\{0\})=\{0,2,3\}$ | $\{1\}$       | $\varnothing$ | $\{2,3\}$     |
| $\{1\}$                                       | $\varnothing$ | $\{3\}$       | $\varnothing$ |
| $\{2,3\}$                                     | $\varnothing$ | $\varnothing$ | $\{2,3\}$     |
| $\{3\}$                                       | $\varnothing$ | $\varnothing$ | $\varnothing$              |


![[public/compile/S0306.svg]]

### 3.3.3. 确定有限自动机的化简

对一个 NFA $M$，当把它确定化后，得到的 DFA 可能包含较多的状态，有些状态有可能是多余或者等价的。因此应该对 DFA 进行化简。

**多余状态** 从初态出发，任何可识别的输入串也不能到达的状态。

设 DFA $M=(S,\Sigma, \delta, s_0, F)$，对 $s,t\in S$，若对任何 $\alpha\in\Sigma^*$，均有 $\delta(s,\alpha)\in F$ 当且仅当 $\delta(t,\alpha)\in F$，则称状态 $s$ 和 $t$ 等价

**定义 3.4** 对一个 DFA $M$，若能找到一个状态比 $M$ 少的 DFA $M^\prime$，使得 $L(M)=L(M^\prime)$，且 $M^\prime$ 满足

1. $M^\prime$ 中没有多余的状态
2. $M^\prime$ 的状态集中，没有两个状态是互相等价的

则称该 DFA $M^\prime$ 是一个最小化的 DFA，也称 DFA 的化简

**DFA $M$ 最小化的具体步骤**

1. 将 DFA $M$ 的状态集 $S$ 划分为两个子集：终态集 $F$ 和非终态集 $\tilde{F}$，形成初始划分 $\Pi$
2. 对 $\Pi$ 建立新的分划 $\Pi_{new}$，对 $\Pi$ 中的每个状态子集 $G$，进行如下变换
    1. 把 $G$ 划分成新的子集，使 $G$ 的两个状态 $s$ 和 $t$ 属于同一个子集，当且仅当对任何输入符号 $a$，状态 $s$ 和 $t$ 转换到的状态都属于 $\Pi$ 的同一个子集
    2. 用 $G$ 划分出来的所有新子集替换为 $G$，形成新的划分 $\Pi_{new}$
3. 如果 $\Pi_{new}$ 和 $\Pi$ 相等，则执行第 4 步；否则，令 $\Pi=\Pi_{new}$，重复第 2 步
4. 划分结束后，对划分中的每个状态子集，选出一个状态作为“代表”，删去其他一切等价的状态，并把射向其他状态的箭弧改为射向这个“代表”的状态

**例 3.6** 将图中 DFA 最小化

![[public/compile/S0307.svg]]

1. 得到两个子集 $\Pi_1=\{A,B,F\}$，$\Pi_2=\{C,D,E,G\}$
2. 对 $\Pi_1$，状态 $A,B$ 均与 $F$ 可区别，因为 $A\xrightarrow{b}{T},B\xrightarrow{b}{T}$，而 $F\overset{b}{\nrightarrow}T$（$T$ 表示终止态），因此 $\Pi_1$ 划分为 $\Pi_{11}=\{A,B\},\Pi_{12}=\{F\}$。进一步，$A,B$ 是两个可区别的状态，因为 $A\xrightarrow{ab}T,B\overset{ab}{\nrightarrow}T$，进而将 $\Pi_1$ 分为三个子集 $\{A\},\{B\},\{F\}$
3. 对 $\Pi_2=\{C,D,E,G\}$，用输入 $b$ 可将其划分为 $\Pi_{21}=\{C,E\},\Pi_{22}=\{D,G\}$，进一步，可将 $\Pi_{21}$ 划分为 $\{C\},\{E\}$

于是划分为了以下子集

$$
\{A\},\{B\},\{F\},\{C\},\{E\},\{D,G\}
$$

![[public/compile/S0308.svg]]

## 3.4. 正规文法、正规式和有限自动机之间的关系

### 3.4.1. 正规式与正规集


